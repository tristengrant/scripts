#!/bin/bash

BLOCK_BUTTON="${BLOCK_BUTTON:-}"

# Safe wrapper for click actions (ignore all output)
mpc_click() { mpc "$@" >/dev/null 2>&1 || true; }

# Exit if MPD not running
pgrep -x mpd >/dev/null 2>&1 || { echo ""; exit 0; }

# Handle click actions
case "$BLOCK_BUTTON" in
    1) mpc_click toggle ;;
    2) mpc_click prev ;;
    3) mpc_click next ;;
esac

# Get current song safely
song=$(mpc current 2>/dev/null) || song=""
[ -z "$song" ] && { echo ""; exit 0; }

# Get playback status safely
status_raw=$(mpc status 2>/dev/null) || status_raw=""
status_line=$(echo "$status_raw" | awk 'NR==2{print}') || status_line=""

# Play/pause symbol
if echo "$status_line" | grep -q '\[paused\]' 2>/dev/null; then
    symbol="⏸"
else
    symbol="▶"
fi

# Output
echo "$symbol $song"

# Force exit 0
exit 0
